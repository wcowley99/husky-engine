cmake_minimum_required(VERSION 3.20)

add_custom_command(
  OUTPUT ${CMAKE_BINARY_DIR}/__shader_sources_autogenerated.h ${CMAKE_BINARY_DIR}/__shader_sources_autogenerated.cpp
  COMMAND python 
  ARGS ${CMAKE_SOURCE_DIR}/embed_shaders.py ${CMAKE_BINARY_DIR} ${CMAKE_SOURCE_DIR}
  DEPENDS ${CMAKE_SOURCE_DIR}/embed_shaders.py
)

set(
  GENERATED_FILES
  "${CMAKE_BINARY_DIR}/__shader_sources_autogenerated.cpp"
  "${CMAKE_BINARY_DIR}/__shader_sources_autogenerated.h"
)

set(
  RENDER_SOURCES
  "render/allocator.cpp"
  "render/allocator.h"
  "render/buffer.cpp"
  "render/buffer.h"
  "render/canvas.h"
  "render/command_builder.h"
  "render/command_builder.cpp"
  "render/compute_pipeline.cpp"
  "render/compute_pipeline.h"
  "render/descriptors.cpp"
  "render/descriptors.h"
  "render/engine.cpp"
  "render/engine.h"
  "render/frames.cpp"
  "render/frames.h"
  "render/graphics_pipeline.cpp"
  "render/graphics_pipeline.h"
  "render/image.cpp"
  "render/image.h"
  "render/imconfig.h"
  "render/immediate_command.cpp"
  "render/immediate_command.h"
  "render/swapchain.cpp"
  "render/swapchain.h"
  "render/vk_base.h"
  "render/vk_base.cpp"
  "render/window.h"
  "render/window.cpp"
)

add_executable(${PROJECT_NAME} 
  main.cpp
  ${RENDER_SOURCES}
  ${GENERATED_FILES}
  ${IMGUI_SOURCES}
)

target_link_libraries(${PROJECT_NAME} PRIVATE 
  SDL3::SDL3
  Vulkan::Headers
  GPUOpen::VulkanMemoryAllocator
  glm::glm
)

target_include_directories(${PROJECT_NAME} PRIVATE 
  ${SDL3_SOURCE_DIR}/include
  ${VMA_SOURCE_DIR}/include
  ${GLM_SOURCE_DIR}
  ${IMGUI_SOURCE_DIR}
  ${IMGUI_SOURCE_DIR}/backends
  ${CMAKE_BINARY_DIR}
)

add_compile_definitions(IMGUI_IMPL_VULKAN_NO_PROTOTYPES)
